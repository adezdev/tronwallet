<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theo Dõi Ví TRON</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Root variables for color scheme */
        :root {
          --primary-color: #3d5afe;
          --secondary-color: #00c853;
          --accent-color: #ff1744;
          --warning-color: #ffab00;
          --dark-bg: #121212;
          --card-bg: #1e1e1e;
          --card-header-bg: #252525;
          --text-color: #e0e0e0;
        }
        
        /* Body styling with gradient background */
        body {
          background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
          background-attachment: fixed;
          font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
          color: var(--text-color);
          min-height: 100vh;
          position: relative;
          overflow-x: hidden;
        }
        
        /* Background pattern overlay */
        body::before {
          content: "";
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect fill="none" width="100" height="100"/><rect fill="rgba(255,255,255,0.05)" width="1" height="1"/></svg>');
          pointer-events: none;
          z-index: -1;
        }
        
        /* Navigation bar styling */
        .navbar {
          background: rgba(30, 30, 46, 0.8);
          backdrop-filter: blur(10px);
          box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .navbar-brand {
          font-weight: bold;
          color: #fff;
          text-shadow: 0 0 10px rgba(61, 90, 254, 0.5);
        }
        
        /* Card styling with glass effect */
        .card {
          background: rgba(30, 30, 46, 0.7);
          backdrop-filter: blur(10px);
          border-radius: 15px;
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
          margin-bottom: 20px;
          border: 1px solid rgba(255, 255, 255, 0.1);
          transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
          overflow: hidden;
        }
        
        .card:hover {
          transform: translateY(-10px);
          box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
          border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Card shine effect */
        .card::after {
          content: "";
          position: absolute;
          top: -50%;
          left: -50%;
          width: 200%;
          height: 200%;
          background: linear-gradient(
            to bottom right,
            rgba(255, 255, 255, 0) 0%,
            rgba(255, 255, 255, 0.05) 50%,
            rgba(255, 255, 255, 0) 100%
          );
          transform: rotate(30deg);
          pointer-events: none;
          z-index: 1;
          transition: transform 0.7s;
        }
        
        .card:hover::after {
          transform: rotate(30deg) translate(10%, 10%);
        }
        
        /* Card header styling */
        .card-header {
          background: rgba(37, 37, 50, 0.8);
          color: white;
          font-weight: bold;
          border-radius: 15px 15px 0 0 !important;
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
          position: relative;
          overflow: hidden;
        }
        
        /* Card header shine animation */
        .card-header::before {
          content: "";
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
          animation: shine 3s infinite;
        }
        
        @keyframes shine {
          0% {
            left: -100%;
          }
          20% {
            left: 100%;
          }
          100% {
            left: 100%;
          }
        }
        
        /* Card body styling */
        .card-body {
          color: var(--text-color);
          position: relative;
          z-index: 2;
        }
        
        /* Button styling */
        .btn {
          border-radius: 8px;
          font-weight: 500;
          letter-spacing: 0.5px;
          text-transform: uppercase;
          transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
          position: relative;
          overflow: hidden;
        }
        
        /* Button ripple effect */
        .btn::after {
          content: "";
          position: absolute;
          top: 50%;
          left: 50%;
          width: 5px;
          height: 5px;
          background: rgba(255, 255, 255, 0.5);
          opacity: 0;
          border-radius: 100%;
          transform: scale(1, 1) translate(-50%);
          transform-origin: 50% 50%;
        }
        
        .btn:focus:not(:active)::after {
          animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
          0% {
            transform: scale(0, 0);
            opacity: 0.5;
          }
          100% {
            transform: scale(20, 20);
            opacity: 0;
          }
        }
        
        /* Primary button styling */
        .btn-primary {
          background: linear-gradient(45deg, #3d5afe, #536dfe);
          border: none;
          box-shadow: 0 4px 15px rgba(61, 90, 254, 0.3);
        }
        
        .btn-primary:hover {
          background: linear-gradient(45deg, #536dfe, #3d5afe);
          box-shadow: 0 8px 25px rgba(61, 90, 254, 0.5);
          transform: translateY(-3px);
        }
        
        /* Success button styling */
        .btn-success {
          background: linear-gradient(45deg, #00c853, #00e676);
          border: none;
          box-shadow: 0 4px 15px rgba(0, 200, 83, 0.3);
        }
        
        .btn-success:hover {
          background: linear-gradient(45deg, #00e676, #00c853);
          box-shadow: 0 8px 25px rgba(0, 200, 83, 0.5);
          transform: translateY(-3px);
        }
        
        /* Danger button styling */
        .btn-danger {
          background: linear-gradient(45deg, #ff1744, #ff5252);
          border: none;
          box-shadow: 0 4px 15px rgba(255, 23, 68, 0.3);
        }
        
        .btn-danger:hover {
          background: linear-gradient(45deg, #ff5252, #ff1744);
          box-shadow: 0 8px 25px rgba(255, 23, 68, 0.5);
          transform: translateY(-3px);
        }
        
        /* Warning button styling */
        .btn-warning {
          background: linear-gradient(45deg, #ffab00, #ffc400);
          border: none;
          box-shadow: 0 4px 15px rgba(255, 171, 0, 0.3);
          color: #212121;
        }
        
        .btn-warning:hover {
          background: linear-gradient(45deg, #ffc400, #ffab00);
          box-shadow: 0 8px 25px rgba(255, 171, 0, 0.5);
          transform: translateY(-3px);
          color: #212121;
        }
        
        /* Alert styling */
        .alert {
          border-radius: 10px;
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
          border: 1px solid rgba(255, 255, 255, 0.1);
          background: rgba(30, 30, 46, 0.7);
          backdrop-filter: blur(10px);
          color: var(--text-color);
        }
        
        /* Transaction card styling */
        .transaction-card {
          transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
          overflow: hidden;
          position: relative;
        }
        
        .transaction-card:hover {
          transform: translateY(-10px) scale(1.02);
          z-index: 10;
        }
        
        .transaction-card i {
          transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
          position: relative;
        }
        
        .transaction-card:hover i {
          transform: scale(1.2) rotate(5deg);
          text-shadow: 0 0 20px currentColor;
        }
        
        /* Transaction card glow effect */
        .transaction-card::before {
          content: "";
          position: absolute;
          top: -50%;
          left: -50%;
          width: 200%;
          height: 200%;
          background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 70%);
          transform: scale(0);
          transition: transform 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        .transaction-card:hover::before {
          transform: scale(1);
        }
        
        /* Footer styling */
        .footer {
          background: rgba(30, 30, 46, 0.8);
          backdrop-filter: blur(10px);
          color: white;
          padding: 20px 0;
          margin-top: 50px;
          box-shadow: 0 -4px 30px rgba(0, 0, 0, 0.3);
          border-top: 1px solid rgba(255, 255, 255, 0.1);
          position: relative;
          overflow: hidden;
        }
        
        /* Footer shine effect */
        .footer::before {
          content: "";
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 2px;
          background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
          animation: shine 3s infinite;
        }
        
        /* Table styling */
        .table {
          color: var(--text-color);
          border-collapse: separate;
          border-spacing: 0 8px;
        }
        
        .table thead th {
          border-bottom: none;
          padding: 15px 10px;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.5px;
          color: rgba(255, 255, 255, 0.8);
          background: rgba(37, 37, 50, 0.5);
        }
        
        .table tbody tr {
          background: rgba(37, 37, 50, 0.3);
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
          transition: all 0.3s;
          border-radius: 10px;
        }
        
        .table tbody tr:hover {
          transform: translateY(-3px);
          box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
          background: rgba(37, 37, 50, 0.5);
        }
        
        .table tbody td {
          padding: 15px 10px;
          border-top: none;
          vertical-align: middle;
        }
        
        .table tbody tr td:first-child {
          border-top-left-radius: 10px;
          border-bottom-left-radius: 10px;
        }
        
        .table tbody tr td:last-child {
          border-top-right-radius: 10px;
          border-bottom-right-radius: 10px;
        }
        
        /* Form control styling */
        .form-control,
        .form-select {
          background: rgba(44, 44, 60, 0.7);
          border: 1px solid rgba(255, 255, 255, 0.1);
          color: var(--text-color);
          border-radius: 8px;
          padding: 12px 15px;
          transition: all 0.3s;
        }
        
        .form-control:focus,
        .form-select:focus {
          background: rgba(49, 49, 68, 0.8);
          border-color: var(--primary-color);
          color: #fff;
          box-shadow: 0 0 0 0.25rem rgba(61, 90, 254, 0.25), 0 0 15px rgba(61, 90, 254, 0.3);
        }
        
        /* Badge styling */
        .badge {
          padding: 0.6em 1em;
          font-weight: 500;
          letter-spacing: 0.5px;
          border-radius: 6px;
        }
        
        /* Exchange wallet badge styling */
        .badge-neon-exchange {
          background: rgba(255, 171, 0, 0.2);
          color: #ffab00;
          box-shadow: 0 0 10px rgba(255, 171, 0, 0.5);
          position: relative;
          overflow: hidden;
          animation: neon-pulse-exchange 2s infinite;
        }
        
        .badge-neon-exchange::before {
          content: "";
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(90deg, transparent, rgba(255, 171, 0, 0.4), transparent);
          animation: neon-shine 2s infinite;
        }
        
        @keyframes neon-pulse-exchange {
          0%,
          100% {
            box-shadow: 0 0 10px rgba(255, 171, 0, 0.5);
          }
          50% {
            box-shadow: 0 0 20px rgba(255, 171, 0, 0.8);
          }
        }
        
        /* External wallet badge styling */
        .badge-neon-external {
          background: rgba(0, 200, 83, 0.2);
          color: #00c853;
          box-shadow: 0 0 10px rgba(0, 200, 83, 0.5);
          position: relative;
          overflow: hidden;
          animation: neon-pulse-external 2s infinite;
        }
        
        .badge-neon-external::before {
          content: "";
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(90deg, transparent, rgba(0, 200, 83, 0.4), transparent);
          animation: neon-shine 2s infinite;
        }
        
        @keyframes neon-pulse-external {
          0%,
          100% {
            box-shadow: 0 0 10px rgba(0, 200, 83, 0.5);
          }
          50% {
            box-shadow: 0 0 20px rgba(0, 200, 83, 0.8);
          }
        }
        
        @keyframes neon-shine {
          0% {
            left: -100%;
          }
          20%,
          100% {
            left: 100%;
          }
        }
        
        /* Navigation link styling */
        .nav-link {
          color: rgba(255, 255, 255, 0.7);
          transition: all 0.3s;
          position: relative;
          padding: 10px 15px;
          margin: 0 5px;
          border-radius: 8px;
          cursor: pointer;
        }
        
        .nav-link:hover {
          color: #fff;
          background: rgba(255, 255, 255, 0.1);
          transform: translateY(-2px);
        }
        
        .nav-link::after {
          content: "";
          position: absolute;
          bottom: 0;
          left: 50%;
          width: 0;
          height: 2px;
          background: var(--primary-color);
          transition: all 0.3s;
          transform: translateX(-50%);
        }
        
        .nav-link:hover::after {
          width: 80%;
        }
        
        .nav-link.active {
          color: #fff;
          background: rgba(61, 90, 254, 0.2);
        }
        
        .nav-link.active::after {
          width: 80%;
        }
        
        /* Input group styling */
        .input-group-text {
          background: var(--primary-color);
          color: white;
          border: 1px solid var(--primary-color);
          border-radius: 0 8px 8px 0;
        }
        
        /* Page transition animation */
        .page-transition {
          animation: fadeIn 0.8s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        /* Glow on hover effect */
        .glow-on-hover {
          position: relative;
          overflow: hidden;
        }
        
        .glow-on-hover::before {
          content: "";
          position: absolute;
          top: -2px;
          left: -2px;
          right: -2px;
          bottom: -2px;
          z-index: -1;
          background: linear-gradient(45deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000);
          background-size: 400%;
          border-radius: 10px;
          opacity: 0;
          transition: opacity 0.3s;
        }
        
        .glow-on-hover:hover::before {
          opacity: 1;
        }
        
        @keyframes glowing {
          0% {
            background-position: 0 0;
          }
          50% {
            background-position: 400% 0;
          }
          100% {
            background-position: 0 0;
          }
        }
        
        /* Page content display */
        .page-content {
          display: none;
          min-height: 70vh;
        }
        
        .active-page {
          display: block;
          animation: fadeIn 0.8s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        /* Row animations */
        .transaction-row {
          animation: slideIn 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        .wallet-row {
          animation: slideIn 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        .order-row {
          animation: slideIn 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        @keyframes slideIn {
          from {
            opacity: 0;
            transform: translateX(-30px);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }
        
        /* Alert container */
        #alertContainer {
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 9999;
          max-width: 350px;
        }
        
        .custom-alert {
          margin-bottom: 10px;
          animation: alertSlideIn 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
          background: rgba(30, 30, 46, 0.9);
          backdrop-filter: blur(10px);
          border: 1px solid rgba(255, 255, 255, 0.1);
          box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }
        
        @keyframes alertSlideIn {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }
        
        /* Floating particles */
        .particles {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          z-index: -1;
          pointer-events: none;
        }
        
        .particle {
          position: absolute;
          width: 3px;
          height: 3px;
          background: rgba(255, 255, 255, 0.5);
          border-radius: 50%;
          animation: float 15s infinite linear;
        }
        
        @keyframes float {
          0% {
            transform: translateY(0) translateX(0);
            opacity: 0;
          }
          10% {
            opacity: 1;
          }
          90% {
            opacity: 1;
          }
          100% {
            transform: translateY(-100vh) translateX(100px);
            opacity: 0;
          }
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
          .card {
            margin-bottom: 15px;
          }
        
          .navbar-brand {
            font-size: 1.2rem;
          }
        
          .table {
            font-size: 0.85rem;
          }
        
          .btn {
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
          }
        
          .transaction-card i {
            font-size: 2rem !important;
          }
        
          .card-header h3,
          .card-header h2 {
            font-size: 1.25rem;
          }
        
          .table-responsive {
            border-radius: 10px;
            overflow: hidden;
          }
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
          width: 10px;
          height: 10px;
        }
        
        ::-webkit-scrollbar-track {
          background: rgba(30, 30, 46, 0.5);
        }
        
        ::-webkit-scrollbar-thumb {
          background: rgba(61, 90, 254, 0.5);
          border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
          background: rgba(61, 90, 254, 0.8);
        }
        
        /* Loading animation */
        .loading-spinner {
          width: 50px;
          height: 50px;
          border: 5px solid rgba(61, 90, 254, 0.3);
          border-radius: 50%;
          border-top-color: var(--primary-color);
          animation: spin 1s ease-in-out infinite;
          margin: 20px auto;
        }
        
        @keyframes spin {
          to {
            transform: rotate(360deg);
          }
        }
        
        .loading-text {
          text-align: center;
          margin-top: 10px;
          color: var(--text-color);
          font-weight: 500;
          letter-spacing: 1px;
        }
        
        /* Wallet info card with neon effect */
        .wallet-info-card {
          border: 1px solid rgba(255, 255, 255, 0.1);
          position: relative;
          overflow: hidden;
        }
        
        .wallet-info-card::before {
          content: "";
          position: absolute;
          top: -2px;
          left: -2px;
          right: -2px;
          bottom: -2px;
          z-index: -1;
          background: linear-gradient(45deg, #3d5afe, #00c853, #ff1744, #ffab00);
          background-size: 400% 400%;
          animation: gradient-border 15s ease infinite;
          border-radius: 16px;
          opacity: 0.3;
        }
        
        @keyframes gradient-border {
          0% {
            background-position: 0% 50%;
          }
          50% {
            background-position: 100% 50%;
          }
          100% {
            background-position: 0% 50%;
          }
        }
        
        /* Text with gradient */
        .gradient-text {
          background: linear-gradient(45deg, #3d5afe, #00c853);
          -webkit-background-clip: text;
          background-clip: text;
          color: transparent;
          font-weight: bold;
        }
        
        /* Hash link with hover effect */
        .hash-link {
          color: var(--primary-color);
          text-decoration: none;
          position: relative;
          transition: all 0.3s;
          word-break: break-all;
        }
        
        .hash-link:hover {
          color: #536dfe;
          text-shadow: 0 0 8px rgba(61, 90, 254, 0.5);
        }
        
        .hash-link::after {
          content: "";
          position: absolute;
          bottom: -2px;
          left: 0;
          width: 0;
          height: 1px;
          background: var(--primary-color);
          transition: width 0.3s;
        }
        
        .hash-link:hover::after {
          width: 100%;
        }
        
        /* Alert types */
        .alert-success {
          background-color: rgba(0, 200, 83, 0.2);
          border-color: rgba(0, 200, 83, 0.3);
          color: #00e676;
        }
        
        .alert-danger {
          background-color: rgba(255, 23, 68, 0.2);
          border-color: rgba(255, 23, 68, 0.3);
          color: #ff5252;
        }
        
        .alert-warning {
          background-color: rgba(255, 171, 0, 0.2);
          border-color: rgba(255, 171, 0, 0.3);
          color: #ffc400;
        }
        
        .alert-info {
          background-color: rgba(61, 90, 254, 0.2);
          border-color: rgba(61, 90, 254, 0.3);
          color: #536dfe;
        }
    </style>
</head>
<body>
<!-- Floating particles -->
<div class="particles" id="particles"></div>

<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
        <a class="navbar-brand" href="#" onclick="navigateTo('home')">
            <i class="fas fa-wallet me-2"></i>Theo Dõi Ví TRON
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" onclick="navigateTo('giaodich')">
                        <i class="fas fa-exchange-alt me-1"></i>Giao Dịch
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="navigateTo('kiemtravi')">
                        <i class="fas fa-search-dollar me-1"></i>Kiểm Tra Ví
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="navigateTo('chuyentoken')">
                        <i class="fas fa-money-bill-transfer me-1"></i>Chuyển Token
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="navigateTo('muadichvu')">
                        <i class="fas fa-shopping-cart me-1"></i>Mua Dịch Vụ
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="navigateTo('danhsachvi')">
                        <i class="fas fa-list me-1"></i>Danh Sách Ví
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="navigateTo('donhang')">
                        <i class="fas fa-clipboard-list me-1"></i>Đơn Hàng
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-4 page-transition">
    <div id="alertContainer"></div>

    <!-- Home Page -->
    <div id="home-page" class="page-content active-page">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="card-header">
                        <h2 class="text-center">Chào mừng đến với Theo Dõi Ví TRON</h2>
                    </div>
                    <div class="card-body">
                        <p class="lead text-center">Theo dõi giao dịch ví TRON, kiểm tra loại ví và nhiều tính năng khác.</p>
                        
                        <div class="row mt-4">
                            <div class="col-md-6 col-lg-3 mb-4">
                                <div class="card transaction-card h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-exchange-alt fa-3x mb-3 text-primary"></i>
                                        <h4>Xem Giao Dịch</h4>
                                        <p>Kiểm tra các giao dịch gần đây cho bất kỳ địa chỉ ví TRON nào.</p>
                                        <a href="#" onclick="navigateTo('giaodich')" class="btn btn-primary glow-on-hover">Xem Giao Dịch</a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-3 mb-4">
                                <div class="card transaction-card h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-wallet fa-3x mb-3 text-success"></i>
                                        <h4>Kiểm Tra Loại Ví</h4>
                                        <p>Xác định xem ví là ví sàn hay ví ngoài.</p>
                                        <a href="#" onclick="navigateTo('kiemtravi')" class="btn btn-success glow-on-hover">Kiểm Tra Ví</a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-3 mb-4">
                                <div class="card transaction-card h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-money-bill-transfer fa-3x mb-3 text-warning"></i>
                                        <h4>Thông Tin Chuyển Token</h4>
                                        <p>Xem thông tin chi tiết về chuyển token cho bất kỳ ví TRON nào.</p>
                                        <a href="#" onclick="navigateTo('chuyentoken')" class="btn btn-warning glow-on-hover">Thông Tin Chuyển Token</a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-3 mb-4">
                                <div class="card transaction-card h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-shopping-cart fa-3x mb-3 text-danger"></i>
                                        <h4>Mua Dịch Vụ</h4>
                                        <p>Mua dịch vụ theo dõi cho ví TRON của bạn.</p>
                                        <a href="#" onclick="navigateTo('muadichvu')" class="btn btn-danger glow-on-hover">Mua Dịch Vụ</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Giao Dich Page -->
    <div id="giaodich-page" class="page-content">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h3>Giao Dịch Gần Đây</h3>
                    </div>
                    <div class="card-body">
                        <form id="giaodich-form" class="mb-4">
                            <div class="input-group">
                                <input type="text" class="form-control" name="address" placeholder="Nhập địa chỉ ví TRON (bắt đầu bằng T)" required>
                                <button type="submit" class="btn btn-primary">Kiểm Tra Giao Dịch</button>
                            </div>
                        </form>
                        
                        <div id="giaodich-results" class="table-responsive">
                            <!-- Transaction data will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kiem Tra Vi Page -->
    <div id="kiemtravi-page" class="page-content">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h3>Kiểm Tra Loại Ví</h3>
                    </div>
                    <div class="card-body">
                        <form id="kiemtravi-form" class="mb-4">
                            <div class="input-group">
                                <input type="text" class="form-control" name="address" placeholder="Nhập địa chỉ ví TRON (bắt đầu bằng T)" required>
                                <button type="submit" class="btn btn-primary">Kiểm Tra Ví</button>
                            </div>
                        </form>
                        
                        <div id="kiemtravi-results">
                            <!-- Wallet info will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chuyen Token Page -->
    <div id="chuyentoken-page" class="page-content">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h3>Thông Tin Chuyển Token</h3>
                    </div>
                    <div class="card-body">
                        <form id="chuyentoken-form" class="mb-4">
                            <div class="input-group">
                                <input type="text" class="form-control" name="address" placeholder="Nhập địa chỉ ví TRON (bắt đầu bằng T)" required>
                                <button type="submit" class="btn btn-primary">Kiểm Tra Chuyển Token</button>
                            </div>
                        </form>
                        
                        <div id="chuyentoken-results" class="table-responsive">
                            <!-- Transfer transaction data will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Them Vi Page -->
    <div id="themvi-page" class="page-content">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h3>Thêm Ví Để Theo Dõi</h3>
                    </div>
                    <div class="card-body">
                        <form id="themvi-form">
                            <div class="mb-3">
                                <label for="address" class="form-label">Địa Chỉ Ví TRON</label>
                                <input type="text" class="form-control" id="address" name="address" placeholder="Nhập địa chỉ ví TRON (bắt đầu bằng T)" required>
                            </div>
                            <div class="mb-3">
                                <label for="name" class="form-label">Tên/Mô Tả Ví</label>
                                <input type="text" class="form-control" id="name" name="name" placeholder="Nhập tên hoặc mô tả cho ví này" required>
                            </div>
                            <div class="mb-3">
                                <label for="username" class="form-label">Tên Người Dùng</label>
                                <input type="text" class="form-control" id="username" name="username" placeholder="Nhập tên người dùng của bạn" value="Người dùng web">
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-success">Thêm Ví</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Danh Sach Vi Page -->
    <div id="danhsachvi-page" class="page-content">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h3>Danh Sách Ví Đang Theo Dõi</h3>
                        <a href="#" onclick="navigateTo('themvi')" class="btn btn-success">Thêm Ví</a>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Địa Chỉ Ví</th>
                                        <th>Tên</th>
                                        <th>Thêm Bởi</th>
                                        <th>Hành Động</th>
                                    </tr>
                                </thead>
                                <tbody id="danhsachvi-results">
                                    <!-- Wallet list will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mua Dich Vu Page -->
    <div id="muadichvu-page" class="page-content">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h3>Mua Dịch Vụ</h3>
                    </div>
                    <div class="card-body">
                        <form id="muadichvu-form">
                            <div class="mb-3">
                                <label for="walletAddress" class="form-label">Địa Chỉ Ví TRON</label>
                                <input type="text" class="form-control" id="walletAddress" name="walletAddress" placeholder="Nhập địa chỉ ví TRON của bạn (bắt đầu bằng T)" required>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Loại Dịch Vụ</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="packageType" id="quantity" value="quantity" checked>
                                    <label class="form-check-label" for="quantity">
                                        Mua theo số lượng (5.3 TRX/lệnh)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="packageType" id="days" value="days">
                                    <label class="form-check-label" for="days">
                                        Mua theo số ngày
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="packageType" id="pay_per_use" value="pay_per_use">
                                    <label class="form-check-label" for="pay_per_use">
                                        Thanh Toán Theo Lệnh Sử Dụng (Liên Hệ Quản Trị Viên)
                                    </label>
                                </div>
                            </div>
                            
                            <div id="quantityOptions" class="mb-3">
                                <label for="quantity" class="form-label">Số Lượng Lệnh</label>
                                <input type="number" class="form-control" id="quantityInput" name="quantity" min="1" value="100">
                            </div>
                            
                            <div id="daysOptions" class="mb-3 d-none">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="commands" class="form-label">Số Lượng Lệnh</label>
                                        <select class="form-select" id="commands" name="commands">
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="9">9</option>
                                            <option value="10">10</option>
                                            <option value="15">15</option>
                                            <option value="20">20</option>
                                            <option value="25">25</option>
                                            <option value="30">30</option>
                                            <option value="35">35</option>
                                            <option value="40">40</option>
                                            <option value="45">45</option>
                                            <option value="50">50</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="days" class="form-label">Số Ngày</label>
                                        <select class="form-select" id="daysInput" name="days">
                                            <option value="7">7 ngày</option>
                                            <option value="15">15 ngày</option>
                                            <option value="30">30 ngày</option>
                                            <option value="60">60 ngày</option>
                                            <option value="90">90 ngày</option>
                                            <option value="180">180 ngày</option>
                                            <option value="365">365 ngày</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary">Tiếp Tục Thanh Toán</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Xac Nhan Thanh Toan Page -->
    <div id="xacnhanthanhtoan-page" class="page-content">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h3>Xác Nhận Thanh Toán</h3>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h4>Đơn Hàng #<span id="orderId"></span></h4>
                            <p><strong>Địa Chỉ Ví:</strong> <span id="walletAddress-display"></span></p>
                            <p><strong>Loại Ví:</strong> <span id="walletType-display"></span></p>
                            <p><strong>Ghi Chú Phí:</strong> <span id="feeNote-display"></span></p>
                            <p><strong>Số Lệnh:</strong> <span id="commands-display"></span></p>
                            <p><strong>Số Ngày:</strong> <span id="days-display"></span></p>
                            <p><strong>Tổng Số Tiền:</strong> <span id="amount-display"></span> TRX</p>
                        </div>
                        
                        <div class="alert alert-warning">
                            <h4>Hướng Dẫn Thanh Toán</h4>
                            <p>Vui lòng gửi <strong><span id="paymentAmount"></span> TRX</strong> đến địa chỉ sau:</p>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" id="paymentAddress" readonly>
                                <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('paymentAddress')">Sao Chép</button>
                            </div>
                            
                            <p>Sau khi gửi thanh toán, nhấn nút bên dưới để kiểm tra trạng thái thanh toán:</p>
                            <div class="d-grid gap-2">
                                <button class="btn btn-primary" id="checkPayment">Kiểm Tra Trạng Thái Thanh Toán</button>
                                <div id="paymentStatus" class="alert alert-info d-none">
                                    Đang kiểm tra trạng thái thanh toán...
                                </div>
                            </div>
                        </div>
                        
                        <form id="confirmForm">
                            <div class="d-grid">
                                <button type="submit" class="btn btn-success">Hoàn Thành Đơn Hàng</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Don Hang Page -->
    <div id="donhang-page" class="page-content">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h3>Quản Lý Đơn Hàng</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Mã Đơn Hàng</th>
                                        <th>ID Người Dùng</th>
                                        <th>Địa Chỉ Ví</th>
                                        <th>Số Lệnh</th>
                                        <th>Số Ngày</th>
                                        <th>Số Tiền</th>
                                        <th>Thời Gian</th>
                                        <th>Trạng Thái</th>
                                        <th>Hành Động</th>
                                    </tr>
                                </thead>
                                <tbody id="donhang-results">
                                    <!-- Order list will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<footer class="footer mt-5">
    <div class="container text-center">
        <!-- Footer content -->
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Global constants
    const TRONGRID_API = "https://api.trongrid.io";
    const PAYMENT_WALLET = "TUoH2VGgCYZxV8h72V1wWq8ThMhY5eNqD";
    const PENDING_ORDERS = {};
    
    // Navigation
    function navigateTo(page) {
        // Hide all pages
        document.querySelectorAll('.page-content').forEach(el => {
            el.classList.remove('active-page');
        });
        
        // Show selected page
        document.getElementById(`${page}-page`).classList.add('active-page');
        
        // Update active nav link
        document.querySelectorAll('.nav-link').forEach(el => {
            el.classList.remove('active');
        });
        
        // Find and activate the correct nav link
        const navLinks = document.querySelectorAll('.nav-link');
        for (const link of navLinks) {
            if (link.getAttribute('onclick') && link.getAttribute('onclick').includes(page)) {
                link.classList.add('active');
                break;
            }
        }
        
        // Initialize page-specific functionality
        if (page === 'danhsachvi') {
            loadWalletList();
        } else if (page === 'donhang') {
            loadOrdersList();
        }
        
        // Scroll to top
        window.scrollTo(0, 0);
    }
    
    // Utility functions
    function shortenAddress(base58Address) {
        return base58Address.length > 12
            ? base58Address.substring(0, 6) + "..." + base58Address.substring(base58Address.length - 6)
            : base58Address;
    }
    
    async function hexToBase58(hexAddress) {
        try {
            if (!hexAddress || hexAddress === "N/A") {
                return "N/A";
            }
            if (hexAddress.startsWith("T")) {
                return hexAddress;
            }
            
            // For client-side implementation, we'll use a simplified approach
            // In a real implementation, you'd use a proper base58 library
            
            // For demo purposes, we'll just return the hex address if it's a contract address
            // or make a call to an API that can convert hex to base58
            
            // This is a placeholder - in a real implementation you would use a proper conversion
            if (hexAddress.startsWith("41")) {
                // Try to fetch from an API that can convert hex to base58
                try {
                    const response = await fetch(`https://apilist.tronscanapi.com/api/account?address=${hexAddress}`);
                    const data = await response.json();
                    if (data && data.address) {
                        return data.address;
                    }
                } catch (e) {
                    console.error("Error fetching base58 address:", e);
                }
                return hexAddress;
            } else if (hexAddress.startsWith("0x")) {
                const hex41 = "41" + hexAddress.substring(2);
                try {
                    const response = await fetch(`https://apilist.tronscanapi.com/api/account?address=${hex41}`);
                    const data = await response.json();
                    if (data && data.address) {
                        return data.address;
                    }
                } catch (e) {
                    console.error("Error fetching base58 address:", e);
                }
                return hex41;
            }
            
            return hexAddress;
        } catch (error) {
            console.error(`Error in hexToBase58: ${error}, hex: ${hexAddress}`);
            return "N/A";
        }
    }
    
    // Function to convert hex to string (for token names)
    function hexToString(hex) {
        try {
            let str = '';
            for (let i = 0; i < hex.length; i += 2) {
                const charCode = parseInt(hex.substr(i, 2), 16);
                if (charCode) {
                    str += String.fromCharCode(charCode);
                }
            }
            return str;
        } catch (e) {
            console.error("Error converting hex to string:", e);
            return "Unknown";
        }
    }
    
    async function getTransactions(address, fingerprint = null) {
        const url = `${TRONGRID_API}/v1/accounts/${address}/transactions`;
        const params = {
            limit: 10,
            only_confirmed: true,
            order_by: "block_timestamp,desc"
        };
        
        if (fingerprint) {
            params.fingerprint = fingerprint;
        }
        
        try {
            const queryString = new URLSearchParams(params).toString();
            const response = await fetch(`${url}?${queryString}`);
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const jsonData = await response.json();
            
            if (!jsonData.success) {
                console.error(`API response unsuccessful for address ${address}`);
                return [null, null];
            }
            
            return [jsonData.data || [], jsonData.meta?.fingerprint];
        } catch (error) {
            console.error(`Error fetching transactions for ${address}: ${error}`);
            return [null, null];
        }
    }
    
    async function getTransactionEvents(txId) {
        const url = `${TRONGRID_API}/v1/transactions/${txId}/events`;
        
        try {
            const response = await fetch(url);
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const jsonData = await response.json();
            return jsonData.success ? jsonData.data || [] : [];
        } catch (error) {
            console.error(`Error fetching events for ${txId}: ${error}`);
            return [];
        }
    }
    
    async function parseTransaction(tx, walletAddress) {
        try {
            const txInfo = {};
            const timestamp = tx.block_timestamp / 1000;
            const dt = new Date(timestamp);
            // Format date in Vietnamese format
            txInfo.date = dt.toLocaleString("vi-VN", {
                hour: "2-digit",
                minute: "2-digit",
                second: "2-digit",
                day: "2-digit",
                month: "2-digit",
                year: "numeric",
                hour12: false
            });
            
            txInfo.energy = tx.energy_usage_total || 0;
            txInfo.hash = tx.txID || "N/A";
            
            const rawData = tx.raw_data?.contract?.[0] || {};
            const contractType = rawData.type || "Unknown";
            const value = rawData.parameter?.value || {};
            
            const sender = await hexToBase58(value.owner_address || "N/A");
            txInfo.sender = sender;
            const isSender = sender === walletAddress;
            
            if (contractType === "TransferContract") {
                const receiver = await hexToBase58(value.to_address || "N/A");
                txInfo.receiver = receiver;
                const amount = (value.amount || 0) / 1_000_000;
                txInfo.amount = `${isSender ? "-" : "+"}${amount.toFixed(6)}`;
                txInfo.token = "TRX";
            } else if (contractType === "TransferAssetContract") {
                const receiver = await hexToBase58(value.to_address || "N/A");
                txInfo.receiver = receiver;
                const amount = (value.amount || 0) / 1_000_000;
                txInfo.amount = `${isSender ? "-" : "+"}${amount.toFixed(6)}`;
                const tokenHex = value.asset_name || "";
                txInfo.token = tokenHex ? hexToString(tokenHex) : "Unknown";
            } else if (contractType === "TriggerSmartContract") {
                const receiver = await hexToBase58(value.contract_address || "N/A");
                txInfo.receiver = receiver;
                const txId = tx.txID || "";
                const TOKEN_MAP = { "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t": "USDT" };
                
                if (txId) {
                    const events = await getTransactionEvents(txId);
                    if (events && events[0]?.result) {
                        const event = events[0];
                        const amount = parseInt(event.result?.value || 0) / 1_000_000;
                        const eventSender = await hexToBase58(event.result?.from || "N/A");
                        const eventReceiver = await hexToBase58(event.result?.to || "N/A");
                        const isEventSender = eventSender === walletAddress;
                        txInfo.amount = `${isEventSender ? "-" : "+"}${amount.toFixed(6)}`;
                        txInfo.token = TOKEN_MAP[receiver] || "TRC20";
                        txInfo.sender = eventSender;
                        txInfo.receiver = eventReceiver;
                    } else {
                        txInfo.amount = "N/A";
                        txInfo.token = "SmartContract";
                    }
                } else {
                    txInfo.amount = "N/A";
                    txInfo.token = "SmartContract";
                }
            } else if (contractType === "DelegateResourceContract") {
                const receiver = await hexToBase58(value.receiver_address || "N/A");
                txInfo.receiver = receiver;
                const amount = (value.balance || 0) / 1_000_000;
                txInfo.amount = `-${amount.toFixed(6)}`;
                txInfo.token = `Resource (${value.resource || "Unknown"})`;
            } else if (contractType === "UnDelegateResourceContract") {
                const receiver = await hexToBase58(value.receiver_address || "N/A");
                txInfo.receiver = receiver;
                const amount = (value.balance || 0) / 1_000_000;
                txInfo.amount = `+${amount.toFixed(6)}`;
                txInfo.token = `Resource (${value.resource || "Unknown"})`;
            } else if (contractType === "FreezeBalanceV2Contract") {
                txInfo.receiver = "N/A";
                const amount = (value.frozen_balance || 0) / 1_000_000;
                txInfo.amount = `-${amount.toFixed(6)}`;
                txInfo.token = `Resource (${value.resource || "Unknown"})`;
            } else if (contractType === "VoteWitnessContract") {
                txInfo.receiver = "N/A";
                txInfo.amount = "Voted";
                txInfo.token = "Action";
            } else {
                txInfo.receiver = "N/A";
                txInfo.amount = "N/A";
                txInfo.token = `Unknown (${contractType})`;
            }
            
            return txInfo;
        } catch (error) {
            console.error(`Error parsing transaction: ${error}`);
            return null;
        }
    }
    
    async function parseTransferTransaction(tx, walletAddress) {
        try {
            const txInfo = {};
            const timestamp = tx.block_timestamp / 1000;
            const dt = new Date(timestamp);
            // Format date in Vietnamese format
            txInfo.time = dt.toLocaleString("vi-VN", {
                hour: "2-digit",
                minute: "2-digit",
                second: "2-digit",
                day: "2-digit",
                month: "2-digit",
                year: "numeric",
                hour12: false
            });
            
            txInfo.hash = tx.txID || "N/A";
            
            const rawData = tx.raw_data?.contract?.[0] || {};
            const contractType = rawData.type || "Unknown";
            const value = rawData.parameter?.value || {};
            
            const sender = await hexToBase58(value.owner_address || "N/A");
            txInfo.from = sender;
            const isSender = sender === walletAddress;
            
            if (contractType === "TransferContract") {
                txInfo.to = await hexToBase58(value.to_address || "N/A");
                const amount = (value.amount || 0) / 1_000_000;
                txInfo.direction = isSender ? "RA" : "NHẬN";
                txInfo.amount = `${amount.toFixed(6)}`;
                txInfo.token = "TRX";
            } else if (contractType === "TransferAssetContract") {
                txInfo.to = await hexToBase58(value.to_address || "N/A");
                const amount = (value.amount || 0) / 1_000_000;
                txInfo.direction = isSender ? "RA" : "NHẬN";
                txInfo.amount = `${amount.toFixed(6)}`;
                const tokenHex = value.asset_name || "";
                txInfo.token = tokenHex ? hexToString(tokenHex) : "Unknown";
            } else if (contractType === "TriggerSmartContract") {
                txInfo.to = await hexToBase58(value.contract_address || "N/A");
                const txId = tx.txID || "";
                const TOKEN_MAP = { "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t": "USDT" };
                
                if (txId) {
                    const events = await getTransactionEvents(txId);
                    if (events && events[0]?.result) {
                        const event = events[0];
                        const amount = parseInt(event.result?.value || 0) / 1_000_000;
                        const eventSender = await hexToBase58(event.result?.from || "N/A");
                        const eventReceiver = await hexToBase58(event.result?.to || "N/A");
                        const isEventSender = eventSender === walletAddress;
                        txInfo.direction = isEventSender ? "RA" : "NHẬN";
                        txInfo.amount = `${amount.toFixed(6)}`;
                        txInfo.token = TOKEN_MAP[txInfo.to] || "TRC20";
                        txInfo.from = eventSender;
                        txInfo.to = eventReceiver;
                    } else {
                        txInfo.direction = "Hợp đồng";
                        txInfo.amount = "N/A";
                        txInfo.token = "SmartContract";
                    }
                } else {
                    txInfo.direction = "Hợp đồng";
                    txInfo.amount = "N/A";
                    txInfo.token = "SmartContract";
                }
            } else if (contractType === "DelegateResourceContract") {
                txInfo.to = await hexToBase58(value.receiver_address || "N/A");
                const amount = (value.balance || 0) / 1_000_000;
                txInfo.direction = "RA";
                txInfo.amount = `${amount.toFixed(6)}`;
                txInfo.token = `Resource (${value.resource || "Unknown"})`;
            } else if (contractType === "UnDelegateResourceContract") {
                txInfo.to = await hexToBase58(value.receiver_address || "N/A");
                const amount = (value.balance || 0) / 1_000_000;
                txInfo.direction = "NHẬN";
                txInfo.amount = `${amount.toFixed(6)}`;
                txInfo.token = `Resource (${value.resource || "Unknown"})`;
            } else if (contractType === "FreezeBalanceV2Contract") {
                txInfo.to = "N/A";
                const amount = (value.frozen_balance || 0) / 1_000_000;
                txInfo.direction = "RA";
                txInfo.amount = `${amount.toFixed(6)}`;
                txInfo.token = `Resource (${value.resource || "Unknown"})`;
            } else if (contractType === "VoteWitnessContract") {
                txInfo.to = "N/A";
                txInfo.direction = "Hành động";
                txInfo.amount = "Đã bỏ phiếu";
                txInfo.token = "Hành động";
            } else {
                txInfo.to = "N/A";
                txInfo.direction = "N/A";
                txInfo.amount = "N/A";
                txInfo.token = `Unknown (${contractType})`;
            }
            
            return txInfo;
        } catch (error) {
            console.error(`Error parsing transfer transaction: ${error}`);
            return null;
        }
    }
    
    async function determineWalletTypeAndFee(transactions, address) {
        if (!transactions || transactions.length === 0) {
            return ["Không xác định", "Không thể kiểm tra phí do thiếu dữ liệu giao dịch", 0];
        }
        
        try {
            // Use the Tronscan API endpoint to check for exchange tags
            const url = `https://apilist.tronscanapi.com/api/transaction?sort=-timestamp&count=true&limit=20&start=0&address=${address}`;
            const response = await fetch(url);
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            
            const exchangeTags = [
                "Binance-Cold 4", "Binance", "Binance.US", "Coinbase", "Coinbase Pro",
                "Huobi", "OKEx", "Kraken", "KuCoin", "Bitfinex", "Gemini", "Bitstamp",
                "Bybit", "Crypto.com", "Gate.io", "Bittrex", "Poloniex", "MEXC",
                "WhiteBIT", "Toobit", "BingX", "Bitget", "Uphold", "CEX.IO"
            ];
            
            let isExchangeWallet = false;
            if (data.data && data.data.length > 0) {
                for (const transaction of data.data) {
                    if (transaction.ownerAddressTag && exchangeTags.includes(transaction.ownerAddressTag)) {
                        isExchangeWallet = true;
                        break;
                    }
                }
            }
            
            const latestTx = transactions[0];
            const energyUsage = latestTx.energy_usage_total || 0;
            
            let walletType, feeNote, displayEnergy;
            
            if (isExchangeWallet) {
                walletType = "Ví sàn";
                feeNote = "Có thể mất thêm TRX (ví dụ: 0.345 TRX)";
                displayEnergy = energyUsage > 0 ? 130285 : energyUsage;
            } else {
                walletType = "Ví ngoài";
                feeNote = "Không mất thêm TRX";
                displayEnergy = energyUsage > 0 ? energyUsage : 64285;
            }
            
            return [walletType, feeNote, displayEnergy];
        } catch (error) {
            console.error(`Error in determineWalletTypeAndFee: ${error}`);
            return ["Không xác định", "Không thể xác định loại ví", 0];
        }
    }
    
    // Local storage functions
    function loadWallets() {
        const walletsJson = localStorage.getItem("wallets");
        return walletsJson ? JSON.parse(walletsJson) : [];
    }
    
    function saveWallet(address, name, username) {
        const wallets = loadWallets();
        
        // Check if wallet already exists
        if (wallets.some(wallet => wallet[0] === address)) {
            return false;
        }
        
        wallets.push([address, name, username]);
        localStorage.setItem("wallets", JSON.stringify(wallets));
        return true;
    }
    
    function saveOrderToStorage(orderId, order) {
        try {
            const orders = JSON.parse(localStorage.getItem("orders") || "{}");
            orders[orderId] = order;
            localStorage.setItem("orders", JSON.stringify(orders));
            console.log(`Order ${orderId} saved to storage`);
            return true;
        } catch (error) {
            console.error(`Error saving order to storage: ${error}`);
            return false;
        }
    }
    
    function loadOrdersFromStorage() {
        try {
            return JSON.parse(localStorage.getItem("orders") || "{}");
        } catch (error) {
            console.error(`Error loading orders from storage: ${error}`);
            return {};
        }
    }
    
    async function checkTronTransaction(amount, walletAddress) {
        const [transactions, _] = await getTransactions(PAYMENT_WALLET);
        if (!transactions) {
            return false;
        }
        
        for (const tx of transactions) {
            const txInfo = await parseTransaction(tx, walletAddress);
            if (txInfo && 
                txInfo.receiver === PAYMENT_WALLET && 
                parseFloat(txInfo.amount.replace(/[+-]/g, "")) === amount) {
                return true;
            }
        }
        
        return false;
    }
    
    // UI functions
    function showAlert(message, type = "info") {
        const alertContainer = document.getElementById("alertContainer");
        if (!alertContainer) return;
        
        const alert = document.createElement("div");
        alert.className = `alert alert-${type} alert-dismissible fade show custom-alert`;
        alert.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        alertContainer.appendChild(alert);
        
        // Auto-dismiss after 5 seconds
        setTimeout(() => {
            alert.classList.remove("show");
            setTimeout(() => {
                alert.remove();
            }, 300);
        }, 5000);
    }
    
    // Create floating particles
    function createParticles() {
        const particlesContainer = document.getElementById("particles");
        if (!particlesContainer) return;
        
        const particleCount = 50;
        
        for (let i = 0; i < particleCount; i++) {
            const particle = document.createElement("div");
            particle.className = "particle";
            
            // Random position
            const posX = Math.random() * 100;
            const posY = Math.random() * 100;
            
            // Random size
            const size = Math.random() * 3 + 1;
            
            // Random opacity
            const opacity = Math.random() * 0.5 + 0.1;
            
            // Random color
            const colors = ["#3d5afe", "#00c853", "#ff1744", "#ffab00", "#ffffff"];
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            // Random animation duration
            const duration = Math.random() * 20 + 10;
            
            // Random animation delay
            const delay = Math.random() * 10;
            
            particle.style.left = `${posX}%`;
            particle.style.top = `${posY}%`;
            particle.style.width = `${size}px`;
            particle.style.height = `${size}px`;
            particle.style.opacity = opacity;
            particle.style.backgroundColor = color;
            particle.style.animationDuration = `${duration}s`;
            particle.style.animationDelay = `${delay}s`;
            
            particlesContainer.appendChild(particle);
        }
    }
    
    // Button ripple effect
    function addRippleEffect() {
        const buttons = document.querySelectorAll(".btn");
        buttons.forEach(button => {
            button.addEventListener("click", function(e) {
                const x = e.clientX - e.target.getBoundingClientRect().left;
                const y = e.clientY - e.target.getBoundingClientRect().top;
                
                const ripple = document.createElement("span");
                ripple.style.position = "absolute";
                ripple.style.width = "1px";
                ripple.style.height = "1px";
                ripple.style.borderRadius = "50%";
                ripple.style.transform = "scale(0)";
                ripple.style.backgroundColor = "rgba(255, 255, 255, 0.7)";
                ripple.style.left = x + "px";
                ripple.style.top = y + "px";
                ripple.style.animation = "ripple 0.6s linear";
                
                button.style.position = "relative";
                button.style.overflow = "hidden";
                button.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                }, 600);
            });
        });
    }
    
    // Copy to clipboard function
    function copyToClipboard(elementId) {
        const element = document.getElementById(elementId);
        element.select();
        document.execCommand("copy");
        alert("Đã sao chép vào clipboard!");
    }
    
    // Page-specific functions
    async function initGiaoDichPage() {
        const form = document.getElementById("giaodich-form");
        if (!form) return;
        
        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            
            const address = form.querySelector('input[name="address"]').value;
            
            if (!address || !address.startsWith("T")) {
                showAlert("Vui lòng nhập địa chỉ ví TRON hợp lệ bắt đầu bằng T.", "danger");
                return;
            }
            
            // Show loading
            const resultsContainer = document.getElementById("giaodich-results");
            if (resultsContainer) {
                resultsContainer.innerHTML = `
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Đang tải giao dịch...</div>
                `;
            }
            
            const [transactions, _] = await getTransactions(address);
            
            if (!transactions) {
                showAlert("Không tìm thấy giao dịch hoặc địa chỉ không hợp lệ.", "warning");
                if (resultsContainer) {
                    resultsContainer.innerHTML = "";
                }
                return;
            }
            
            const parsedTransactions = [];
            for (const tx of transactions) {
                const parsed = await parseTransaction(tx, address);
                if (parsed) {
                    parsedTransactions.push(parsed);
                }
            }
            
            if (parsedTransactions.length === 0) {
                showAlert("Không có giao dịch nào trong 10 giao dịch gần nhất.", "warning");
                if (resultsContainer) {
                    resultsContainer.innerHTML = "";
                }
                return;
            }
            
            // Render transactions
            let html = `
                <h4>Giao dịch cho ví ${address}</h4>
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Thời Gian</th>
                            <th>Từ</th>
                            <th>Đến</th>
                            <th>Số Lượng</th>
                            <th>Token</th>
                            <th>Energy</th>
                            <th>Hash</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            for (const tx of parsedTransactions) {
                html += `
                    <tr class="transaction-row">
                        <td>${tx.date}</td>
                        <td>${tx.sender}</td>
                        <td>${tx.receiver}</td>
                        <td class="${tx.amount.startsWith("+") ? "text-success" : tx.amount.startsWith("-") ? "text-danger" : ""}">
                            ${tx.amount}
                        </td>
                        <td>${tx.token}</td>
                        <td>${tx.energy}</td>
                        <td>
                            <a href="https://tronscan.org/#/transaction/${tx.hash}" target="_blank" class="hash-link">
                                ${tx.hash}
                            </a>
                        </td>
                    </tr>
                `;
            }
            
            html += `
                    </tbody>
                </table>
            `;
            
            if (resultsContainer) {
                resultsContainer.innerHTML = html;
            }
        });
    }
    
    async function initKiemTraViPage() {
        const form = document.getElementById("kiemtravi-form");
        if (!form) return;
        
        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            
            const address = form.querySelector('input[name="address"]').value;
            
            if (!address || !address.startsWith("T") || address.length !== 34) {
                showAlert("Vui lòng nhập địa chỉ ví TRON hợp lệ bắt đầu bằng T và dài 34 ký tự.", "danger");
                return;
            }
            
            // Show loading
            const resultsContainer = document.getElementById("kiemtravi-results");
            if (resultsContainer) {
                resultsContainer.innerHTML = `
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Đang kiểm tra ví...</div>
                `;
            }
            
            const [transactions, _] = await getTransactions(address);
            
            if (!transactions) {
                showAlert("Không tìm thấy giao dịch hoặc địa chỉ không hợp lệ.", "warning");
                if (resultsContainer) {
                    resultsContainer.innerHTML = "";
                }
                return;
            }
            
            const [walletType, feeNote, displayEnergy] = await determineWalletTypeAndFee(transactions, address);
            
            const latestTx = transactions[0];
            const txInfo = await parseTransaction(latestTx, address) || {};
            
            // Render wallet info
            const html = `
                <div class="card wallet-info-card">
                    <div class="card-header bg-primary text-white">
                        <h4>Thông Tin Ví</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Địa Chỉ:</strong> ${address}</p>
                                <p><strong>Loại Ví:</strong> 
                                    ${
                                        walletType === "Ví sàn"
                                        ? `<span class="badge badge-neon-exchange">${walletType}</span>`
                                        : walletType === "Ví ngoài"
                                        ? `<span class="badge badge-neon-external">${walletType}</span>`
                                        : `<span class="badge badge-neon-exchange">${walletType}</span>`
                                    }
                                </p>
                                <p><strong>Ghi Chú Phí:</strong> ${feeNote}</p>
                                <p><strong>Energy Sử Dụng:</strong> ${displayEnergy}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Giao Dịch Gần Nhất:</strong></p>
                                <p><strong>Từ:</strong> ${txInfo.sender || "N/A"}</p>
                                <p><strong>Đến:</strong> ${txInfo.receiver || "N/A"}</p>
                                <p><strong>Thời Gian:</strong> ${txInfo.date || "N/A"}</p>
                                <p><strong>Hash:</strong> 
                                    <a href="https://tronscan.org/#/transaction/${txInfo.hash || "N/A"}" target="_blank" class="hash-link">
                                        ${txInfo.hash || "N/A"}
                                    </a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            if (resultsContainer) {
                resultsContainer.innerHTML = html;
            }
        });
    }
    
    async function initChuyenTokenPage() {
        const form = document.getElementById("chuyentoken-form");
        if (!form) return;
        
        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            
            const address = form.querySelector('input[name="address"]').value;
            
            if (!address || !address.startsWith("T")) {
                showAlert("Vui lòng nhập địa chỉ ví TRON hợp lệ bắt đầu bằng T.", "danger");
                return;
            }
            
            // Show loading
            const resultsContainer = document.getElementById("chuyentoken-results");
            if (resultsContainer) {
                resultsContainer.innerHTML = `
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Đang tải thông tin chuyển token...</div>
                `;
            }
            
            const [transactions, _] = await getTransactions(address);
            
            if (!transactions) {
                showAlert("Không tìm thấy giao dịch hoặc địa chỉ không hợp lệ.", "warning");
                if (resultsContainer) {
                    resultsContainer.innerHTML = "";
                }
                return;
            }
            
            const parsedTransactions = [];
            for (const tx of transactions) {
                const parsed = await parseTransferTransaction(tx, address);
                if (parsed) {
                    parsedTransactions.push(parsed);
                }
            }
            
            if (parsedTransactions.length === 0) {
                showAlert("Không có giao dịch chuyển token nào trong 10 giao dịch gần nhất.", "warning");
                if (resultsContainer) {
                    resultsContainer.innerHTML = "";
                }
                return;
            }
            
            // Render transfer transactions
            let html = `
                <h4>Thông tin chuyển token cho ví ${address}</h4>
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Thời Gian</th>
                            <th>Từ</th>
                            <th>Đến</th>
                            <th>Hướng</th>
                            <th>Số Lượng</th>
                            <th>Token</th>
                            <th>Hash</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            for (const tx of parsedTransactions) {
                html += `
                    <tr class="transaction-row">
                        <td>${tx.time}</td>
                        <td>${tx.from}</td>
                        <td>${tx.to}</td>
                        <td>
                            ${
                                tx.direction === "NHẬN"
                                ? '<span class="badge badge-neon-external">NHẬN</span>'
                                : tx.direction === "RA"
                                ? '<span class="badge badge-neon-exchange">RA</span>'
                                : `<span class="badge bg-secondary">${tx.direction}</span>`
                            }
                        </td>
                        <td>${tx.amount}</td>
                        <td>${tx.token}</td>
                        <td>
                            <a href="https://tronscan.org/#/transaction/${tx.hash}" target="_blank" class="hash-link">
                                ${tx.hash}
                            </a>
                        </td>
                    </tr>
                `;
            }
            
            html += `
                    </tbody>
                </table>
            `;
            
            if (resultsContainer) {
                resultsContainer.innerHTML = html;
            }
        });
    }
    
    function initThemViPage() {
        const form = document.getElementById("themvi-form");
        if (!form) return;
        
        form.addEventListener("submit", (e) => {
            e.preventDefault();
            
            const address = form.querySelector('input[name="address"]').value;
            const name = form.querySelector('input[name="name"]').value;
            const username = form.querySelector('input[name="username"]').value || "Người dùng web";
            
            if (!address || !address.startsWith("T")) {
                showAlert("Vui lòng nhập địa chỉ ví TRON hợp lệ bắt đầu bằng T.", "danger");
                return;
            }
            
            const success = saveWallet(address, name, username);
            
            if (!success) {
                showAlert(`Ví ${address} đã được theo dõi.`, "warning");
                return;
            }
            
            showAlert(`Ví ${address} đã được thêm vào danh sách theo dõi với tên "${name}" bởi ${username}.`, "success");
            
            // Redirect to wallet list page
            setTimeout(() => {
                navigateTo('danhsachvi');
            }, 2000);
        });
    }
    
    function loadWalletList() {
        const wallets = loadWallets();
        const tableBody = document.getElementById("danhsachvi-results");
        
        if (!tableBody) return;
        
        if (wallets.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="5" class="text-center">
                        Không có ví nào đang được theo dõi. <a href="#" onclick="navigateTo('themvi')">Thêm ví</a> để bắt đầu theo dõi.
                    </td>
                </tr>
            `;
            return;
        }
        
        let html = "";
        
        for (let i = 0; i < wallets.length; i++) {
            const wallet = wallets[i];
            html += `
                <tr class="wallet-row">
                    <td>${i + 1}</td>
                    <td>${wallet[0]}</td>
                    <td>${wallet[1]}</td>
                    <td>${wallet[2]}</td>
                    <td>
                        <button onclick="checkWalletTransactions('${wallet[0]}')" class="btn btn-sm btn-primary">Giao Dịch</button>
                        <button onclick="checkWalletInfo('${wallet[0]}')" class="btn btn-sm btn-info">Kiểm Tra</button>
                        <button onclick="checkWalletTransfers('${wallet[0]}')" class="btn btn-sm btn-warning">Chuyển Token</button>
                    </td>
                </tr>
            `;
        }
        
        tableBody.innerHTML = html;
    }
    
    function checkWalletTransactions(address) {
        // Navigate to giao dich page and fill the form
        navigateTo('giaodich');
        const form = document.getElementById("giaodich-form");
        if (form) {
            form.querySelector('input[name="address"]').value = address;
            form.dispatchEvent(new Event("submit"));
        }
    }
    
    function checkWalletInfo(address) {
        // Navigate to kiem tra vi page and fill the form
        navigateTo('kiemtravi');
        const form = document.getElementById("kiemtravi-form");
        if (form) {
            form.querySelector('input[name="address"]').value = address;
            form.dispatchEvent(new Event("submit"));
        }
    }
    
    function checkWalletTransfers(address) {
        // Navigate to chuyen token page and fill the form
        navigateTo('chuyentoken');
        const form = document.getElementById("chuyentoken-form");
        if (form) {
            form.querySelector('input[name="address"]').value = address;
            form.dispatchEvent(new Event("submit"));
        }
    }
    
    function initMuaDichVuPage() {
        const packageTypeRadios = document.querySelectorAll('input[name="packageType"]');
        const quantityOptions = document.getElementById("quantityOptions");
        const daysOptions = document.getElementById("daysOptions");
        
        packageTypeRadios.forEach(radio => {
            radio.addEventListener("change", function() {
                if (this.value === "quantity") {
                    quantityOptions.classList.remove("d-none");
                    daysOptions.classList.add("d-none");
                } else if (this.value === "days") {
                    quantityOptions.classList.add("d-none");
                    daysOptions.classList.remove("d-none");
                } else {
                    quantityOptions.classList.add("d-none");
                    daysOptions.classList.add("d-none");
                }
            });
        });
        
        const form = document.getElementById("muadichvu-form");
        if (!form) return;
        
        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            
            const walletAddress = form.querySelector('input[name="walletAddress"]').value;
            const packageType = form.querySelector('input[name="packageType"]:checked').value;
            
            if (!walletAddress || !walletAddress.startsWith("T")) {
                showAlert("Vui lòng nhập địa chỉ ví TRON hợp lệ bắt đầu bằng T.", "danger");
                return;
            }
            
            let quantity, days, total;
            
            if (packageType === "quantity") {
                quantity = parseInt(form.querySelector('input[name="quantity"]').value || 0);
                days = 0;
                const pricePerCommand = 5.3;
                total = quantity * pricePerCommand;
            } else if (packageType === "days") {
                quantity = parseInt(form.querySelector('select[name="commands"]').value || 0);
                days = parseInt(form.querySelector('select[name="days"]').value || 0);
                const pricePerCommand = 5.3;
                total = quantity * days * pricePerCommand;
            } else {
                showAlert("Tùy chọn thanh toán theo lệnh sử dụng yêu cầu liên hệ quản trị viên.", "info");
                return;
            }
            
            // Show loading
            form.querySelector('button[type="submit"]').disabled = true;
            form.querySelector('button[type="submit"]').innerHTML = `
                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                Đang xử lý...
            `;
            
            const [transactions, _] = await getTransactions(walletAddress);
            const [walletType, feeNote] = await determineWalletTypeAndFee(transactions, walletAddress);
            
            const orderId = `web_${Date.now()}`;
            const order = {
                userId: "web_user",
                amount: total,
                commands: quantity,
                days: days,
                walletAddress: walletAddress,
                timestamp: new Date().toLocaleString("vi-VN"),
                status: "pending"
            };
            
            // Save order to storage
            PENDING_ORDERS[orderId] = order;
            saveOrderToStorage(orderId, order);
            
            // Navigate to payment confirmation page
            navigateTo('xacnhanthanhtoan');
            
            // Populate payment confirmation page
            document.getElementById("orderId").textContent = orderId;
            document.getElementById("walletAddress-display").textContent = walletAddress;
            document.getElementById("walletType-display").textContent = walletType;
            document.getElementById("feeNote-display").textContent = feeNote;
            document.getElementById("commands-display").textContent = quantity;
            document.getElementById("days-display").textContent = days;
            document.getElementById("amount-display").textContent = total;
            document.getElementById("paymentAmount").textContent = total;
            document.getElementById("paymentAddress").value = PAYMENT_WALLET;
            
            // Reset form
            form.querySelector('button[type="submit"]').disabled = false;
            form.querySelector('button[type="submit"]').innerHTML = "Tiếp Tục Thanh Toán";
        });
    }
    
    function initXacNhanThanhToanPage() {
        const checkPaymentBtn = document.getElementById("checkPayment");
        if (!checkPaymentBtn) return;
        
        checkPaymentBtn.addEventListener("click", async () => {
            const orderId = document.getElementById("orderId").textContent;
            const statusDiv = document.getElementById("paymentStatus");
            
            if (!orderId || !statusDiv) return;
            
            statusDiv.classList.remove("d-none");
            statusDiv.classList.remove("alert-success", "alert-danger");
            statusDiv.classList.add("alert-info");
            statusDiv.textContent = "Đang kiểm tra trạng thái thanh toán...";
            
            const orders = loadOrdersFromStorage();
            const order = orders[orderId] || PENDING_ORDERS[orderId];
            
            if (!order) {
                statusDiv.classList.remove("alert-info");
                statusDiv.classList.add("alert-danger");
                statusDiv.textContent = "Không tìm thấy đơn hàng.";
                return;
            }
            
            const isPaid = await checkTronTransaction(order.amount, order.walletAddress);
            
            if (isPaid) {
                statusDiv.classList.remove("alert-info");
                statusDiv.classList.add("alert-success");
                statusDiv.textContent = "Thanh toán đã được xác nhận! Đơn hàng của bạn đã được kích hoạt.";
                
                // Update order status
                order.status = "paid";
                saveOrderToStorage(orderId, order);
                
                setTimeout(() => {
                    navigateTo('home');
                }, 2000);
            } else {
                statusDiv.classList.remove("alert-info");
                statusDiv.classList.add("alert-warning");
                statusDiv.textContent = "Chưa phát hiện thanh toán. Vui lòng thử lại sau vài phút.";
            }
        });
        
        const confirmForm = document.getElementById("confirmForm");
        if (confirmForm) {
            confirmForm.addEventListener("submit", (e) => {
                e.preventDefault();
                
                const orderId = document.getElementById("orderId").textContent;
                if (!orderId) return;
                
                const orders = loadOrdersFromStorage();
                const order = orders[orderId] || PENDING_ORDERS[orderId];
                
                if (!order) {
                    showAlert("Không tìm thấy đơn hàng.", "danger");
                    return;
                }
                
                // Update order status
                order.status = "paid";
                saveOrderToStorage(orderId, order);
                
                showAlert("Thanh toán đã được xác nhận! Đơn hàng của bạn đã được kích hoạt.", "success");
                
                setTimeout(() => {
                    navigateTo('home');
                }, 2000);
            });
        }
    }
    
    function loadOrdersList() {
        // Load orders from storage
        const orders = loadOrdersFromStorage();
        const ordersList = [];
        
        for (const orderId in orders) {
            const order = orders[orderId];
            ordersList.push({
                orderId,
                ...order
            });
        }
        
        // Add pending orders
        for (const orderId in PENDING_ORDERS) {
            if (PENDING_ORDERS[orderId].status === "pending") {
                ordersList.push({
                    orderId,
                    ...PENDING_ORDERS[orderId]
                });
            }
        }
        
        const tableBody = document.getElementById("donhang-results");
        
        if (!tableBody) return;
        
        if (ordersList.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="9" class="text-center">Không tìm thấy đơn hàng nào.</td>
                </tr>
            `;
            return;
        }
        
        let html = "";
        
        for (const order of ordersList) {
            html += `
                <tr class="order-row">
                    <td>${order.orderId}</td>
                    <td>${order.userId}</td>
                    <td>${order.walletAddress}</td>
                    <td>${order.commands}</td>
                    <td>${order.days}</td>
                    <td>${order.amount} TRX</td>
                    <td>${order.timestamp}</td>
                    <td>
                        ${
                            order.status === "pending"
                            ? '<span class="badge badge-neon-exchange">Đang Chờ</span>'
                            : order.status === "paid"
                            ? '<span class="badge badge-neon-external">Đã Thanh Toán</span>'
                            : `<span class="badge bg-secondary">${order.status}</span>`
                        }
                    </td>
                    <td>
                        ${
                            order.status === "pending"
                            ? `<button type="button" class="btn btn-sm btn-success complete-order" data-order-id="${order.orderId}">Đánh Dấu Đã Thanh Toán</button>`
                            : ""
                        }
                    </td>
                </tr>
            `;
        }
        
        tableBody.innerHTML = html;
        
        // Add event listeners for complete order buttons
        const completeOrderButtons = document.querySelectorAll(".complete-order");
        completeOrderButtons.forEach(button => {
            button.addEventListener("click", function() {
                const orderId = this.getAttribute("data-order-id");
                
                // Update order status
                const orders = loadOrdersFromStorage();
                if (orders[orderId]) {
                    orders[orderId].status = "paid";
                    localStorage.setItem("orders", JSON.stringify(orders));
                }
                
                if (PENDING_ORDERS[orderId]) {
                    PENDING_ORDERS[orderId].status = "paid";
                }
                
                showAlert(`Đơn hàng ${orderId} đã được đánh dấu là đã thanh toán.`, "success");
                
                // Refresh the orders list
                setTimeout(() => {
                    loadOrdersList();
                }, 2000);
            });
        });
    }
    
    // Initialize the application
    document.addEventListener("DOMContentLoaded", () => {
        // Create floating particles
        createParticles();
        
        // Add ripple effect to buttons
        addRippleEffect();
        
        // Initialize page-specific functionality
        initGiaoDichPage();
        initKiemTraViPage();
        initChuyenTokenPage();
        initThemViPage();
        initMuaDichVuPage();
        initXacNhanThanhToanPage();
        
        // Set active nav link based on hash or default to home
        const hash = window.location.hash.substring(1);
        if (hash) {
            navigateTo(hash);
        } else {
            navigateTo('home');
        }
        
        // Handle URL hash changes
        window.addEventListener('hashchange', () => {
            const hash = window.location.hash.substring(1);
            if (hash) {
                navigateTo(hash);
            }
        });
    });
</script>
</body>
</html>
